[생활코딩 - WEB2 - Home server](https://opentutorials.org/course/3265) 정리

![web-router](/assets/web/web-router.PNG)

### router
IP address란  
기기에 접속하기 위한 고유 번호.  
통신사와 계약을 해서 연결하는 순간 부여받는다  

근데 문제는 집에서 쓰는 회선이 하나라는거  
제일 단순한 방법은 회선을 더 계약하는거지만 비싸다  
그래서 공유기를 쓴다.  

공유기를 보면  
WAN, LAN이 있다.

계약한 회선을 WAN에 각 기기들을 LAN에 연결한다.  
이렇게되면  
통신사와 계약을 해서 받은 IP는 공유기의 것이 된다.  
그리고 나머지는 공유기를 중심으로 같은 네트워크에 묶여있다.  

이것을 지역 네트워크라고 한다.  
Local Area Network(LAN)  

또한 공유기는 동시에 인터넷이라고하는 광역 네트워크에 소속되어있다.  
Wide Area Network(WAN)  


이렇듯 WAN과 LAN 사이에서 교환원 같은 역할을 하는게 공유기(router)의 역할  


공유기로부터 기기들이 LAN에 연결되는 순간 각 기기들은 고유의 IP를 또 다시 부여받는다.  
그리고 LAN안에서 공유기도 네트워크에 일부이므로 IP를 또 부여받는다(192.168.0.1)  
공유기에 부여된 IP는 특수한 중요한 IP이므로 이름이 따로 있다  
이를 Gateway address 또는 Router address라고 부른다.  


WAN에 연결되어 부여받은 IP는 전세계 누구나 접속 가능하다는 의미에서  
public IP address 공용 아이피라고 부르고

LAN에 연결되어 부여받은 IP는 내선번호와 같이 내부에서만 쓰는 IP이므로  
private IP address 사설 아이피라고 부른다.

| IP 대역  |  
|---|
| 10.0.0.0 - 10.255.255.255  |
| 172.16.0.0 - 172.31.255.255  |
| 192.168.0.0 - 192.168.255.255  |
표와 같이 위의 범위는 사설 아이피로 쓰기로 전세계적으로 약속되어있다.


![nat](/assets/web/web-nat.PNG)

### 클라이언트로서의 NAT (Network Address Translation)
공유기에 연결된 장치들이 인터넷을 통해서 공유기 밖의 정보에 접속할 수 있는 것은 NAT라는 기능 덕분때문이다.  

우리가 위키에 들어간다고 치면 내부적으로 Gateway address에 해당하는 IP의 머신에게 요청한다.  
들어온 요청이 LAN에 속해있는 애가 아니라면 WAN을 통해서 외부로 보내게 되는데  
이 때 공유기 내부에서 두가지 일을 하는데  
첫번째 요청을 한 대상(192.168.0.4)의 요청이라는 것을 기록한다.  
두번째 NAT라는 기술을 이용해 요청하는 데이터의 내용을 192.168.0.4에서 59.6.66.238이라고 변경한다.  

그리고 위키에서 요청을 받아서 다시 공유기로 응답을 할텐데  
이것을 아까 기록해두었던걸 보고 다시 192.168.0.4로 변경해서 내 컴퓨터로 다시 보내준다.

### 포트포워딩
포트 0 ~ 65535 까지 있다  
0 ~ 1023 - well-known port  

말그대로 포트를 포워딩하는 것  

예를들어서  
59.6.66.238:8081 -> 192.168.0.4:80  

59.6.66.238의 8081 포트로 접속이 들어오면  
192.168.0.4의 80번 포트로 보낸다.  
이런식으로 해서 공유기에 연결된 서버를 외부에서 접속가능하도록 만들 수 있다.  


### DHCP (Dynamic Host Configuration Protocol)
공유기는 보통 DHCP Server 라는게 내장되어있고
기기들은 보통 DHCP Client 라는게 내장되어있다.

mac address 통신 부품의 고유 식별자

새로운 기기가 공유기에 연결되었을 때
1. DHCP Client는 DHCP Server에게 본인의 mac address를 알려주면서 IP주소를 요청한다.
2. DHCP Server는 정보를 받고 Server의 mac address와 IP 주소를 응답으로 보내준다.
3. DHCP Client는 DHCP Server에게 해당 id를 쓰겠다고 다시 보낸다.
4. DHCP Server는 DHCP Client에게 승인과 동시에 ip를 사용가능한 시간을 알려준다.

### 유동 아이피와 고정 아이피 (Dynamic IP Address - Static IP Adress)

모든 사람들에게 아이피를 고정으로 주기에는 부족하다.  
그리고 모든 사람들이 동시에 인터넷을 쓰는건 아니기 때문에  
유동적으로 ip를 할당하는 것을 말한다.  
속된말로 돌려막기(?)이다.
